generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      Role     @default(MANAGER)
  name      String?
  createdAt DateTime @default(now())
  vehicles  Vehicle[] 
}

enum Role {
  ADMIN
  MANAGER
  DRIVER
  ACCOUNTANT
}

model Vehicle {
  id           String      @id @default(uuid())
  name         String
  imei         String      @unique
  plateNumber  String?
  vendor       String?
  createdAt    DateTime    @default(now())
  telemetries  Telemetry[]
  tyres        Tyre[]
  documents    VehicleDocuments?
  ownerId      String
  owner        User        @relation(fields: [ownerId], references: [id])
}

model Telemetry {
  id            String   @id @default(uuid())
  vehicleId     String
  vehicle       Vehicle  @relation(fields: [vehicleId], references: [id])
  rawPayload    Json
  lat           Float
  lon           Float
  speed         Float
  ignition      Boolean
  motion        Boolean
  totalDistance Float
  todayDistance Float
  timestamp     DateTime
  createdAt     DateTime @default(now())
}

model FuelLog {
  id          String   @id @default(uuid())
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id])
  liters      Float
  odometer    Float
  source      String
  createdAt   DateTime @default(now())
}

model Tyre {
  id          String   @id @default(uuid())
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id])
  serial      String
  position    String
  installedAt DateTime
  removedAt   DateTime?
  createdAt   DateTime @default(now())
  history     TyreHistory[]
}

model TyreHistory {
  id        String   @id @default(uuid())
  tyreId    String
  tyre      Tyre     @relation(fields: [tyreId], references: [id])
  action    String
  notes     String?
  createdAt DateTime @default(now())
}

model Geofence {
  id         String   @id @default(uuid())
  name       String
  polygon    Json
  createdAt  DateTime @default(now())
}

model GeofenceAlert {
  id         String   @id @default(uuid())
  geofenceId String
  vehicleId  String
  type       String
  message    String
  createdAt  DateTime @default(now())
}

model VehicleDocuments {
  id          String   @id @default(uuid())
  vehicleId   String   @unique
  rcExpires   DateTime?
  insuranceExpires DateTime?
  pucExpires  DateTime?
  fitnessExpires DateTime?
  permitExpires DateTime?
  taxExpires  DateTime?
  createdAt   DateTime @default(now())
}
